<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<!-- autogenerated by 'erl2html2'. -->
<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8"/></meta>
<title>/Users/erszcz/work/erszcz/docsh/_build/test/lib/docsh/test/edoc_SUITE.erl</title>
</head>

<body bgcolor="white" text="black" link="blue" vlink="purple" alink="red">
<pre>
<a name="1"/>    1: <b>-module</b>(edoc_SUITE).
<a name="2"/>    2: <b>-compile</b>([export_all, nowarn_export_all]).
<a name="3"/>    3: 
<a name="4"/>    4: <b>-include_lib</b>(&quot;eunit/include/eunit.hrl&quot;).
<a name="5"/>    5: <b>-include</b>(&quot;proplists_eq.hrl&quot;).
<a name="6"/>    6: 
<a name="7"/>    7: <b>-define</b>(eq(Expected, Actual), ?proplists_eq(Expected, Actual)).
<a name="8"/>    8: <b>-define</b>(TESTED, docsh_edoc).
<a name="9"/>    9: 
<a name="all-0"/><a name="10"/>   10: <b>all</b>() -&gt;
<a name="all-last_expr"/><a name="11"/>   11:     [edoc_to_internal,
<a name="12"/>   12:      edoc_format,
<a name="13"/>   13:      edoc_format_code_in_loose_text,
<a name="14"/>   14:      edoc_format_dl,
<a name="15"/>   15:      edoc_format_p,
<a name="16"/>   16:      edoc_format_pre,
<a name="17"/>   17:      edoc_format_text1,
<a name="18"/>   18:      edoc_format_text2,
<a name="19"/>   19:      edoc_format_ul].
<a name="20"/>   20: 
<a name="edoc_to_internal-1"/><a name="21"/>   21: <b>edoc_to_internal</b>(_) -&gt;
<a name="22"/>   22:     {ok, DBeam} = docsh_beam:from_loaded_module(edoc_example),
<a name="23"/>   23:     ct:pal(&quot;~p&quot;, [DBeam]),
<a name="edoc_to_internal-last_expr"/><a name="24"/>   24: <b>    ?assertEqual</b>( #{name =&gt; edoc_example,
<a name="25"/>   25:                     description =&gt; &lt;&lt;&quot;Top-level module doc.&quot;&gt;&gt;,
<a name="26"/>   26:                     functions =&gt; [ #{kind =&gt; function,
<a name="27"/>   27:                                      name =&gt; f,
<a name="28"/>   28:                                      arity =&gt; 0,
<a name="29"/>   29:                                      exported =&gt; true,
<a name="30"/>   30:                                      description =&gt; &lt;&lt;&quot;Doc for f/0.&quot;&gt;&gt;} ],
<a name="31"/>   31:                     types =&gt; [ #{kind =&gt; type,
<a name="32"/>   32:                                  name =&gt; r,
<a name="33"/>   33:                                  arity =&gt; 0,
<a name="34"/>   34:                                  description =&gt; &lt;&lt;&quot;Doc for type r().&quot;&gt;&gt;},
<a name="35"/>   35:                                #{kind =&gt; type,
<a name="36"/>   36:                                  name =&gt; s,
<a name="37"/>   37:                                  arity =&gt; 0,
<a name="38"/>   38:                                  description =&gt; &lt;&lt;&quot;Example opaque type s().&quot;&gt;&gt;},
<a name="39"/>   39:                                #{kind =&gt; type,
<a name="40"/>   40:                                  name =&gt; t,
<a name="41"/>   41:                                  arity =&gt; 1,
<a name="42"/>   42:                                  description =&gt; &lt;&lt;&quot;Unary type t/1.&quot;&gt;&gt;} ]},
<a name="43"/>   43: 
<a name="44"/>   44:                   unwrap(?TESTED:to_internal(DBeam)) ).
<a name="45"/>   45: 
<a name="edoc_format-1"/><a name="46"/>   46: <b>edoc_format</b>(_) -&gt;
<a name="47"/>   47:     {ok, DBeam} = docsh_beam:from_loaded_module(edoc_example2),
<a name="48"/>   48:     D = function_description({g,0}, unwrap(?TESTED:to_internal(DBeam))),
<a name="49"/>   49:     ct:pal(&quot;~s&quot;, [D]),
<a name="edoc_format-last_expr"/><a name="50"/>   50: <b>    ?eq</b>([&lt;&lt;&quot;g() returns a more complex value,\n&quot;
<a name="51"/>   51:            &quot;while its documentation uses more complex markup.\n&quot;
<a name="52"/>   52:            &quot;\n&quot;
<a name="53"/>   53:            &quot;  Why?\n&quot;
<a name="54"/>   54:            &quot;\n&quot;
<a name="55"/>   55:            &quot;      To test the documentation extraction and formatting process.\n&quot;
<a name="56"/>   56:            &quot;\n&quot;
<a name="57"/>   57:            &quot;  Any other reason?\n&quot;
<a name="58"/>   58:            &quot;\n&quot;
<a name="59"/>   59:            &quot;      Not really.\n&quot;
<a name="60"/>   60:            &quot;\n&quot;
<a name="61"/>   61:            &quot;\n&quot;
<a name="62"/>   62:            &quot;  - Some\n&quot;
<a name="63"/>   63:            &quot;  - Random\n&quot;
<a name="64"/>   64:            &quot;  - Items\n&quot;
<a name="65"/>   65:            &quot;\n&quot;
<a name="66"/>   66:            &quot;  1. One\n&quot;
<a name="67"/>   67:            &quot;  2. Two\n&quot;
<a name="68"/>   68:            &quot;  3. Three:\n&quot;
<a name="69"/>   69:            &quot;      - a\n&quot;
<a name="70"/>   70:            &quot;      - b\n&quot;
<a name="71"/>   71:            &quot;      - c\n&quot;&gt;&gt;],
<a name="72"/>   72:         [D]).
<a name="73"/>   73: 
<a name="edoc_format_code_in_loose_text-1"/><a name="74"/>   74: <b>edoc_format_code_in_loose_text</b>(C) -&gt;
<a name="edoc_format_code_in_loose_text-last_expr"/><a name="75"/>   75: <b>    edoc_format</b>(C, code_in_loose_text, &lt;&lt;&quot;Fetch the internal state of an OTP process.\n&quot;
<a name="76"/>   76:                                          &quot;Calls sys:get_state/2 directly in R16B01+, and fetches\n&quot;
<a name="77"/>   77:                                          &quot;it dynamically on older versions of OTP.\n&quot;&gt;&gt;).
<a name="78"/>   78: 
<a name="edoc_format_dl-1"/><a name="79"/>   79: <b>edoc_format_dl</b>(C) -&gt;
<a name="edoc_format_dl-last_expr"/><a name="80"/>   80: <b>    edoc_format</b>(C, dl, &lt;&lt;&quot;  sys_alloc\n&quot;
<a name="81"/>   81:                          &quot;\n&quot;
<a name="82"/>   82:                          &quot;      System allocator, usually just malloc\n&quot;
<a name="83"/>   83:                          &quot;\n&quot;
<a name="84"/>   84:                          &quot;  mseg_alloc\n&quot;
<a name="85"/>   85:                          &quot;\n&quot;
<a name="86"/>   86:                          &quot;      Used by other allocators, can do mmap. Caches allocations\n&quot;
<a name="87"/>   87:                          &quot;\n&quot;&gt;&gt;).
<a name="88"/>   88: 
<a name="edoc_format_p-1"/><a name="89"/>   89: <b>edoc_format_p</b>(C) -&gt;
<a name="edoc_format_p-last_expr"/><a name="90"/>   90: <b>    edoc_format</b>(C, p, &lt;&lt;&quot;Just\n&quot;
<a name="91"/>   91:                         &quot;a paragraph.\n&quot;&gt;&gt;).
<a name="92"/>   92: 
<a name="edoc_format_pre-1"/><a name="93"/>   93: <b>edoc_format_pre</b>(C) -&gt;
<a name="edoc_format_pre-last_expr"/><a name="94"/>   94: <b>    edoc_format</b>(C, pre, &lt;&lt;&quot;    pre\n&quot;
<a name="95"/>   95:                           &quot;      formatted\n&quot;
<a name="96"/>   96:                           &quot;        text\n&quot;&gt;&gt;).
<a name="97"/>   97: 
<a name="edoc_format_text1-1"/><a name="98"/>   98: <b>edoc_format_text1</b>(C) -&gt;
<a name="edoc_format_text1-last_expr"/><a name="99"/>   99: <b>    edoc_format</b>(C, text1, &lt;&lt;&quot;Some\n&quot;
<a name="100"/>  100:                             &quot;loose text,\n&quot;
<a name="101"/>  101:                             &quot;not a paragraph.\n&quot;&gt;&gt;).
<a name="102"/>  102: 
<a name="edoc_format_text2-1"/><a name="103"/>  103: <b>edoc_format_text2</b>(C) -&gt;
<a name="edoc_format_text2-last_expr"/><a name="104"/>  104: <b>    edoc_format</b>(C, text2, &lt;&lt;&quot;Some\n&quot;
<a name="105"/>  105:                             &quot;loose text,\n&quot;
<a name="106"/>  106:                             &quot;not a paragraph.\n&quot;
<a name="107"/>  107:                             &quot;\n&quot;
<a name="108"/>  108:                             &quot;A paragraph.\n&quot;&gt;&gt;).
<a name="109"/>  109: 
<a name="edoc_format_ul-1"/><a name="110"/>  110: <b>edoc_format_ul</b>(C) -&gt;
<a name="edoc_format_ul-last_expr"/><a name="111"/>  111: <b>    edoc_format</b>(C, ul, &lt;&lt;&quot;  - Module is any atom representing a module\n&quot;
<a name="112"/>  112:                          &quot;  - Function is any atom representing a function, or the wildcard\n&quot;
<a name="113"/>  113:                          &quot;    '_'\n&quot;
<a name="114"/>  114:                          &quot;  - Args is either the arity of a function (0..255), a wildcard\n&quot;
<a name="115"/>  115:                          &quot;    pattern ('_'), a\n&quot;
<a name="116"/>  116:                          &quot;    match specification,\n&quot;
<a name="117"/>  117:                          &quot;    or a function from a shell session that can be transformed into\n&quot;
<a name="118"/>  118:                          &quot;    a match specification\n&quot;&gt;&gt;).
<a name="119"/>  119: 
<a name="edoc_format-3"/><a name="120"/>  120: <b>edoc_format</b>(_, Element, Expected) -&gt;
<a name="121"/>  121:     {ok, DBeam} = docsh_beam:from_loaded_module(edoc_example2),
<a name="122"/>  122:     D = function_description({Element, 0}, unwrap(?TESTED:to_internal(DBeam))),
<a name="123"/>  123:     ct:pal(&quot;~s&quot;, [D]),
<a name="edoc_format-last_expr"/><a name="124"/>  124: <b>    ?eq</b>([Expected], [D]).
<a name="125"/>  125: 
<a name="function_description-2"/><a name="126"/>  126: <b>function_description</b>({Name, Arity}, #{functions := Functions}) -&gt;
<a name="function_description-last_expr"/><a name="127"/>  127: <b>    maps:get</b>(description, hd([ F || F = #{name := FName, arity := FArity } &lt;- Functions,
<a name="128"/>  128:                                     FName =:= Name, FArity =:= Arity ])).
<a name="129"/>  129: 
<a name="source_file-1"/><a name="130"/>  130: <b>source_file</b>(Mod) -&gt;
<a name="source_file-last_expr"/><a name="131"/>  131: <b>    proplists:get_value</b>(source, Mod:module_info(compile)).
<a name="132"/>  132: 
<a name="unwrap-1"/><a name="133"/>  133: <b>unwrap</b>({ok, V}) -&gt; V;
<a name="unwrap-last_expr"/><a name="134"/>  134: <b>unwrap</b>(Else) -&gt; erlang:error(not_ok, [Else]).
</pre>
</body>
</html>
