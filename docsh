#!/bin/sh

do_erl () {
    erl -sname docsh -noinput -noshell \
    -pa _build/default/lib/docsh/ebin/ \
    -pa _build/default/lib/docsh/test \
    $@
}

edoc () {
    local subcmd=$1
    local module=$2
    case $subcmd in
    flat)
        export DOCSH_DEBUG=flat
        do_erl -eval 'docsh_edoc:flat("'$module'"),halt().'
        ;;
    xml)
        export DOCSH_DEBUG=xml
        do_erl -eval 'docsh_edoc:to_internal("'$module'"),halt().' \
            | sed -n -e '/^<?xml/,$p' \
            | xmllint --format -
        ;;
    tree)
        export DOCSH_DEBUG=edoc
        do_erl -eval 'docsh_edoc:to_internal("'$module'"),halt().'
        ;;
    esac
}

case $1 in
edoc)
    shift
    edoc $@
    ;;
*)
    echo $0: $cmd unknown
    usage
    ;;
esac
